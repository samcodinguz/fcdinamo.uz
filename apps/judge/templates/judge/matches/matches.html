{% extends "judge/judge.html" %} {% load static %} {% block title %}FC Dinamo - {{ page_title }}{% endblock title %} {% block css %} {% endblock css %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex align-items-center gap-2 mb-3">
                <span class="me-2 fw-semibold">Filter:</span>
                <form method="get" class="d-flex gap-2">
                    <!-- Category -->
                    <select class="form-select" name="category" onchange="this.form.submit()">
                        <option value="all">Barchasi</option>
                        {% for cat in categorys %}
                        <option value="{{ cat.id }}" {% if category == cat.id %}selected{% endif %}>
                            {{ cat.name }}
                        </option>
                        {% endfor %}
                    </select>
                    
                    <!-- Status -->
                    <select class="form-select" name="season" onchange="this.form.submit()">
                        <option value="all">Barchasi</option>
                        {% for year in seasons %}
                        <option value="{{ year }}" {% if season == year %}selected{% endif %}>
                            {{ year }}
                        </option>
                        {% endfor %}
                    </select>

                    <!-- Records Per Page -->
                    <select class="form-select form-control my-1 my-md-0" name="per_page" onchange="this.form.submit()">
                        <option value="5" {% if per_page == "5" %}selected{% endif %}>5</option>
                        <option value="10" {% if per_page == "10" %}selected{% endif %}>10</option>
                        <option value="15" {% if per_page == "15" %}selected{% endif %}>15</option>
                        <option value="20" {% if per_page == "20" %}selected{% endif %}>20</option>
                    </select>
                </form>
            </div>
            <form method="post">
                {% csrf_token %}
                <div data-table  data-table-rows-per-page="{{ per_page }}" class="card">
                    <div class="card-header border-light justify-content-between">
                        <div class="d-flex gap-2">
                            <div class="app-search">
                                <input data-table-search type="search" class="form-control" placeholder="Qidiruv..." />
                                <i class="ti ti-search app-search-icon text-muted"></i>
                            </div>
                            <button class="btn btn-danger d-none" type="submit" data-table-delete-selected>
                                Delete
                            </button>
                        </div>
                        <div class="d-flex gap-1">
                            <a href="#!" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMatchModal">
                                <i class="ti ti-plus fs-sm me-2"></i>
                                O'yin qo'shish
                            </a>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-custom table-centered table-striped table-select table-hover w-100 mb-0">
                            <thead class="bg-light align-middle bg-opacity-25 thead-sm">
                                <tr class="text-uppercase fs-xxs">
                                    <th class="ps-3" style="width: 1%">
                                        <input data-table-select-all class="form-check-input form-check-input-light fs-14 mt-0" type="checkbox" id="select-all-products" value="option" />
                                    </th>
                                    <th data-table-sort data-column="category">Lega nomi</th>
                                    <th data-table-sort data-column="team-type">Jamoa turi</th>
                                    <th style="min-width: 150px;" class="text-end">Uydagi jamoa</th>
                                    <th style="width: 1%;"></th>
                                    <th class="text-center">Natija</th>
                                    <th style="width: 1%;"></th>
                                    <th style="min-width: 150px;">Mehmondagi jamoa</th>
                                    <th>Boshlanish vaqti</th>
                                    <th>Status</th>
                                    <th class="text-center" style="width: 1%">Amallar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in matches_list %}
                                <tr>
                                    <td class="ps-3">
                                        <input class="form-check-input form-check-input-light fs-14 product-item-check mt-0" type="checkbox" name="selected_ids" value="{{ match.id }}" value="option" />
                                    </td>
                                    <td>{{ match.season.league.name|title }}</td>
                                    <td>{{ match.season.team_type.name|title }}</td>
                                    <td class="text-end">{{ match.home_team.name }}</td>
                                    <td>
                                        <div class="avatar-lg d-flex justify-content-center align-items-center">
                                            <img src="{{ match.home_team.logo.url }}" alt="{{ match.home_team.name }}" class="img-fluid rounded-pill" />
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        {% if match.is_finished %}
                                        {{ match.home_goals }} : {{ match.away_goals }}
                                        {% else %}
                                        - : -
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="avatar-lg d-flex justify-content-center align-items-center">
                                            <img src="{{ match.away_team.logo.url }}" alt="{{ match.away_team.name }}" class="img-fluid rounded-pill" />
                                        </div>
                                    </td>
                                    <td>{{ match.away_team.name }}</td>
                                    <td>{{ match.match_date|date:"d-m-Y H:i"}}</td>
                                    <td>
                                        {% if match.is_finished %}
                                        <span class="badge badge-soft-danger p-1">Yakunlangan</span>
                                        {% else %}
                                        <span class="badge badge-soft-primary p-1">Boshlanmagan</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="d-flex justify-content-center gap-1">
                                            <a href="{% url 'judge_matches_edit' match.id %}"
                                            class="btn btn-default btn-icon btn-sm edit-match-btn"
                                            data-bs-toggle="modal"
                                            data-bs-target="#editMatchModal"
                                            data-team-type="{{ match.season.team_type.name }}"
                                            data-season="{{ match.season.year }}"
                                            data-league="{{ match.season.league.name }}"
                                            data-home-team="{{ match.home_team.name }}"
                                            data-away-team="{{ match.away_team.name }}"
                                            data-date="{{ match.match_date|date:'d-m-Y H:i' }}"
                                            data-home-goals="{{ match.home_goals }}"
                                            data-away-goals="{{ match.away_goals }}"
                                            data-finished="{{ match.is_finished }}">
                                                <i class="ti ti-edit fs-lg"></i>
                                            </a>

                                            <a href="{% url 'judge_matches_delete' match.id %}" class="btn btn-default btn-icon btn-sm single-delete-btn">
                                                <i class="ti ti-trash fs-lg"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="card-footer border-0">
                        <div class="d-flex justify-content-between align-items-center">
                            <ul class="pagination pagination-sm pagination-boxed mb-0 mx-auto">
                                <li class="page-item {% if not matches_list.has_previous %}disabled{% endif %}">
                                    <a class="page-link" href="{% if matches_list.has_previous %}?page={{ matches_list.previous_page_number }}{% else %}#{% endif %}" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>
                                {% for page in pagination_range %}
                                {% if page == '...' %}
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                                {% elif page == matches_list.number %}
                                <li class="page-item active"><a class="page-link" href="?{% if per_page %}per_page={{ per_page }}&{% endif %}{% if season %}season={{ season }}&{% endif %}page={{ page }}">{{ page }}</a></li>
                                {% else %}
                                <li class="page-item"><a class="page-link" href="?{% if per_page %}per_page={{ per_page }}&{% endif %}{% if season %}season={{ season }}&{% endif %}page={{ page }}">{{ page }}</a></li>
                                {% endif %}
                                {% endfor %}
                                <li class="page-item {% if not matches_list.has_next %}disabled{% endif %}">
                                    <a class="page-link" href="{% if matches_list.has_next %}?{% if per_page %}per_page={{ per_page }}&{% endif %}page={{ matches_list.next_page_number }}{% else %}#{% endif %}" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <!-- end col -->
    </div>
    <!-- end row -->
    <!-- Add Match Modal -->
    <div class="modal fade" id="addMatchModal" tabindex="-1" aria-labelledby="addMatchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addMatchModalLabel">Yangi o'yin qo'shish</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form method="post" action="{% url 'judge_matches_add' %}">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="row g-3">
                            <!-- Team type -->
                            <div class="col-12">
                                <label class="form-label" for="addTeamType">Jamo turi</label>
                                <select name="team_type" id="addTeamType" class="form-select" required>
                                    {% for cat in categorys %}
                                    <option value="{{ cat.id }}">{{ cat.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Season -->
                            <div class="col-6">
                                <label class="form-label">Mavsum</label>
                                <select name="season_year" class="form-select" required>
                                    {% for year in seasons %}
                                    <option value="{{ year }}">{{ year }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- League -->
                            <div class="col-6">
                                <label class="form-label">Lega</label>
                                <select name="league" class="form-select" required>
                                    {% for league in leagues %}
                                    <option value="{{ league.id }}">{{ league.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Home team -->
                            <div class="col-6">
                                <label class="form-label">Uy jamoa</label>
                                <select name="home_team" class="form-select" required>
                                    {% for team in teams %}
                                    <option value="{{ team.id }}">{{ team.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Away team -->
                            <div class="col-6">
                                <label class="form-label">Mehmon jamoa</label>
                                <select name="away_team" class="form-select" required>
                                    {% for team in teams %}
                                    <option value="{{ team.id }}">{{ team.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- Match date -->
                            <div class="col-12">
                                <label class="form-label">Boshlanish vaqti</label>
                                <input type="datetime-local" name="match_date" class="form-control" required>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Uy jamoa gollari</label>
                                <input type="number" name="home_goals" class="form-control" min="0" value="0">
                            </div>

                            <div class="col-6">
                                <label class="form-label">Mehmon jamoa gollari</label>
                                <input type="number" name="away_goals" class="form-control" min="0" value="0">
                            </div>

                            <!-- Is finished -->
                            <div class="col-12">
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" name="is_finished" id="isFinished">
                                    <label class="form-check-label" for="isFinished">
                                        O'yin yakunlangan
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Yo'q</button>
                        <button type="submit" class="btn btn-primary">O'yin qo'shish</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- end modal-->
    <!-- Edit Match Modal -->
    <div class="modal fade" id="editMatchModal" tabindex="-1" aria-labelledby="editMatchModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editMatchModalLabel">O'yinni tahirilash</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <form method="post" id="editMatchForm">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Jamoa turi</label>
                                <input type="text" class="form-control" id="editTeamType" readonly>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Mavsum</label>
                                <input type="text" class="form-control" id="editSeason" readonly>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Lega</label>
                                <input type="text" class="form-control" id="editLeague" readonly>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Uy jamoa</label>
                                <input type="text" class="form-control" id="editHomeTeam" readonly>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Mehmon jamoa</label>
                                <input type="text" class="form-control" id="editAwayTeam" readonly>
                            </div>

                            <!-- Match date -->
                            <div class="col-12">
                                <label class="form-label">Boshlanish vaqti</label>
                                <input type="text" class="form-control" id="editMatchDate" readonly>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Uy jamoa gollari</label>
                                <input type="number" name="home_goals" class="form-control" id="editHomeGoals" min="0" value="0" required>
                            </div>

                            <div class="col-6">
                                <label class="form-label">Mehmon jamoa gollari</label>
                                <input type="number" name="away_goals" class="form-control" id="editAwayGoals" min="0" value="0" required>
                            </div>

                            <!-- Is finished -->
                            <div class="col-12">
                                <div class="form-check mt-2">
                                    <input class="form-check-input" type="checkbox" name="is_finished" id="editIsFinished">
                                    <label class="form-check-label" for="isFinished">
                                        O'yin yakunlangan
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Yo'q</button>
                        <button type="submit" class="btn btn-primary">Saqlash</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- end modal-->
</div>
{% endblock content %} {% block js %}
<!-- Custom table -->
<script src="{% static 'js/pages/custom-table.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const editButtons = document.querySelectorAll(".edit-match-btn");
        const form = document.getElementById("editMatchForm");

        const teamtype = document.getElementById("editTeamType");
        const season = document.getElementById("editSeason");
        const league = document.getElementById("editLeague");
        const hometeam = document.getElementById("editHomeTeam");
        const awayteam = document.getElementById("editAwayTeam");
        const data = document.getElementById("editMatchDate");

        const homeGoals = document.getElementById("editHomeGoals");
        const awayGoals = document.getElementById("editAwayGoals");
        const isFinished = document.getElementById("editIsFinished");

        editButtons.forEach(btn => {
            btn.addEventListener("click", function (e) {
                e.preventDefault();

                form.action = this.href;
                teamtype.value = this.dataset.teamType;
                season.value = this.dataset.season;
                league.value = this.dataset.league;
                hometeam.value = this.dataset.homeTeam;
                awayteam.value = this.dataset.awayTeam;
                data.value = this.dataset.date;
                homeGoals.value = this.dataset.homeGoals;
                awayGoals.value = this.dataset.awayGoals;
                isFinished.checked = this.dataset.finished === "True";
            });
        });
    });
</script>
{% endblock js %}